## run before tests, but not loaded via `load_all()` and not installed with package

d <- 60

kostra <- get_stats("49011")

# get_stats("49011") |> dput() -------------------------------------------------

kostra_ref <- structure(
  list(
    D_min   = c(5, 10, 15, 20, 30, 45, 60, 90, 120, 180, 240, 360, 540, 720, 1080, 1440, 2880, 4320),
    D_hour  = c(NA, NA, NA, NA, NA, NA, 1, 1.5, 2, 3, 4, 6, 9, 12, 18, 24, 48, 72),
    D_day   = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1, 2, 3),
    HN_001A = c(5.6, 8.6, 10.5, 11.8, 13.5, 14.9, 15.7, 17.4, 18.8, 20.9, 22.5, 25, 27.8, 30, 33.3, 35.9, 44.1, 49.8),
    HN_002A = c(6.9, 10.6, 13, 14.7, 17.1, 19.4, 21, 22.9, 24.4, 26.7, 28.5, 31.2, 34.2, 36.5, 40.1, 42.8, 52.2, 58.6),
    HN_003A = c(7.7, 11.7, 14.4, 16.4, 19.2, 22.1, 24.1, 26.2, 27.7, 30.1, 32, 34.8, 37.9, 40.3, 44, 46.8, 57, 63.7),
    HN_005A = c(8.7, 13.1, 16.2, 18.5, 21.9, 25.4, 28, 30.2, 31.9, 34.4, 36.4, 39.3, 42.6, 45.1, 49, 51.9, 62.9, 70.2),
    HN_010A = c(10, 15.1, 18.6, 21.4, 25.5, 29.9, 33.3, 35.7, 37.5, 40.2, 42.3, 45.5, 49, 51.6, 55.7, 58.8, 71, 79),
    HN_020A = c(11.3, 17.1, 21.1, 24.3, 29.1, 34.4, 38.7, 41.2, 43.1, 46, 48.3, 51.7, 55.3, 58.2, 62.5, 65.8, 79.1, 87.7),
    HN_030A = c(12.1, 18.2, 22.5, 25.9, 31.2, 37.1, 41.8, 44.4, 46.4, 49.4, 51.8, 55.3, 59.1, 62, 66.4, 69.8, 83.8, 92.9),
    HN_050A = c(13.1, 19.6, 24.3, 28.1, 33.9, 40.4, 45.7, 48.5, 50.6, 53.7, 56.1, 59.8, 63.8, 66.8, 71.4, 74.9, 89.8, 99.3),
    HN_100A = c(14.4, 21.6, 26.8, 30.9, 37.5, 45, 51, 53.9, 56.2, 59.6, 62.1, 66, 70.1, 73.3, 78.1, 81.8, 97.9, 108.1)
    ),
  class = c("tbl_df", "tbl", "data.frame"),
  row.names = c(NA, -18L),
  id = "49011",
  period = structure(list(sec    = c(0, 0),
                          min    = c(0L, 0L),
                          hour   = c(0L, 0L),
                          mday   = c(1L, 31L),
                          mon    = c(0L, 11L),
                          year   = c(51L, 110L),
                          wday   = c(1L, 5L),
                          yday   = c(0L, 364L),
                          isdst  = c(0L, 0L),
                          zone   = c("CET", "CET"),
                          gmtoff = c(NA_integer_, NA_integer_)),
                     class = c("POSIXlt", "POSIXt"),
                     tzone = c("CET", "CET", "CEST")
                     ),
  returnperiods_a = c(1, 2, 3, 5, 10, 20, 30, 50, 100),
  durations_min = c(5, 10, 15, 20, 30, 45, 60, 90, 120, 180, 240, 360, 540, 720, 1080, 1440, 2880, 4320),
  source = "KOSTRA-DWD-2010R"
  )



# read_p_stats("rhj-2543.csv") -------------------------------------------------

stats_ref <- structure(list(
  D_min   = c(5, 10, 15, 20, 30, 45, 60, 90, 120, 180, 240, 360, 540, 720, 1080, 1440, 2880, 4320, 5760, 7200, 8640),
  D_hour  = c(NA, NA, NA, NA, NA, NA, 1, 1.5, 2, 3, 4, 6, 9, 12, 18, 24, 48, 72, 96, 120, 144),
  D_day   = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1, 2, 3, 4, 5, 6),
  HN_001A = c(6.1, 7.7, 8.8, 9.6, 11, 12.6, 13.8, 15.7, 17.3,19.7, 21.2, 23.5, 26.1, 28, 31.1, 33.4, 41.7, 47.4, 52, 55.9, 59.2),
  HN_002A = c(7.4, 9.8, 11.5, 12.7, 14.6, 16.7, 18.3, 20.8, 22.8, 25.8, 27.4, 30, 32.8, 34.9, 38.2, 40.7, 49.6, 55.7, 60.5, 64.5, 68),
  HN_003A = c(8.2, 11.4, 13.4, 14.9, 17.2, 19.7, 21.6, 24.5, 26.7, 30.1, 31.9, 34.6, 37.6, 39.9, 43.4, 46, 55.3, 61.6, 66.6, 70.8, 74.4),
  HN_005A = c(9, 12.7, 15, 16.8, 19.4, 22.2, 24.4, 27.6, 30, 33.7, 35.6, 38.5, 41.6, 44, 47.6, 50.4, 60, 66.6, 71.7, 76, 79.7),
  HN_010A = c(10.2, 14.8, 17.7, 19.9, 23, 26.4, 28.9, 32.7, 35.5, 39.7, 41.8, 45, 48.3, 50.9, 54.8, 57.7, 67.9, 74.8, 80.2, 84.6, 88.5),
  HN_020A = c(11.4, 17, 20.4, 22.9, 26.6, 30.5, 33.4, 37.7, 41, 45.7, 48, 51.4, 55.1, 57.8, 61.9, 65.1, 75.8, 83, 88.6, 93.3, 97.3),
  HN_025A = c(11.8, 17.6, 21.3, 23.9, 27.8, 31.9, 34.9, 39.4, 42.7, 47.7, 50, 53.5, 57.2, 60, 64.2, 67.4, 78.4, 85.7, 91.4, 96.1, 100.1),
  HN_033A = c(12.3, 18.5, 22.4, 25.2, 29.3, 33.6, 36.8, 41.5, 45, 50.2, 52.6, 56.2, 60, 62.9, 67.2, 70.5, 81.6, 89.1, 94.9, 99.7, 103.8),
  HN_050A = c(13, 19.8, 23.9, 27, 31.4, 36, 39.5, 44.5, 48.2, 53.7, 56.2, 59.9, 63.9, 66.9, 71.4, 74.7, 86.3, 93.9, 99.9, 104.7, 108.9),
  HN_100A = c(14.2, 21.9, 26.6, 30.1, 35, 40.2, 44, 49.6, 53.7, 59.7, 62.4, 66.4, 70.6, 73.8, 78.5, 82.1, 94.2, 102.2, 108.3, 113.4, 117.8)
  ),
  row.names = c(NA, -21L),
  class = c("tbl_df", "tbl", "data.frame"),
  id = "2543",
  name = "Gelsenkirchen-Bismarck PWK",
  period = structure(c(-662664600, 1641018600),
                     class = c("POSIXct", "POSIXt"),
                     tzone = "etc/GMT-1"),
  returnperiods_a = c(1, 2, 3.3, 5, 10, 20, 25, 33.3, 50, 100),
  durations_min = c(5, 10, 15, 20, 30, 45, 60, 90, 120, 180, 240, 360, 540, 720, 1080, 1440, 2880, 4320, 5760, 7200, 8640),
  source = "DWA-A 531"
  )



pen1 <- calc_pen(kostra_ref)

pen2 <- calc_pen(stats_ref)

# calc_pen(kostra_ref) |> dput() -----------------------------------------------

pen_ref <- structure(
  list(
    D_min     = c(5, 10, 15, 20, 30, 45, 60, 90, 120, 180, 240, 360, 540, 720, 1080, 1440, 2880, 4320),
    D_hour    = c(NA, NA, NA, NA, NA, NA, 1, 1.5, 2, 3, 4, 6, 9, 12, 18, 24, 48, 72),
    D_day     = c(NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 1, 2, 3),
    HN_200A   = c(19.1, 28.7, 35.6, 41.1, 49.9, 60.1, 68.3, 72.1, 75, 79.5, 82.7, 87.7, 93, 97.1, 103.3, 108.1, 129.2, 142.5),
    HN_500A   = c(21.6, 32.3, 40.1, 46.3, 56.5, 68.2, 77.7, 81.8, 85.1, 89.9, 93.5, 99, 104.8, 109.3, 116, 121.2, 144.7, 159.4),
    HN_1000A  = c(23.4, 35, 43.5, 50.3, 61.4, 74.3, 84.7, 89.2, 92.7, 97.9, 101.7, 107.6, 113.7, 118.4, 125.6, 131.1, 156.4, 172.2),
    HN_2000A  = c(25.2, 37.7, 46.9, 54.3, 66.4, 80.4, 91.8, 96.6, 100.3, 105.8, 109.8, 116.1, 122.6, 127.6, 135.2, 141, 168.1, 184.9),
    HN_5000A  = c(27.7, 41.4, 51.5, 59.6, 72.9, 88.5, 101.2, 106.3, 110.4, 116.3, 120.6, 127.4, 134.3, 139.7, 147.9, 154.1, 183.6, 201.8),
    HN_10000A = c(29.5, 44.1, 54.9, 63.5, 77.9, 94.6, 108.3, 113.7, 118, 124.2, 128.8, 135.9, 143.2, 148.9, 157.5, 164, 195.3, 214.6)
    ),
  row.names = c(NA, -18L),
  class = c("tbl_df", "tbl", "data.frame"),
  id = "49011",
  period = structure(list(sec    = c(0, 0),
                          min    = c(0L, 0L),
                          hour   = c(0L, 0L),
                          mday   = c(1L, 31L),
                          mon    = c(0L, 11L),
                          year   = c(51L, 110L),
                          wday   = c(1L, 5L),
                          yday   = c(0L, 364L),
                          isdst  = c(0L, 0L),
                          zone   = c("CET", "CET"),
                          gmtoff = c(NA_integer_, NA_integer_)),
                     class = c("POSIXlt", "POSIXt"),
                     tzone = c("CET", "CET", "CEST")
                     ),
  returnperiods_a = c(200, 500, 1000, 2000, 5000, 10000),
  durations_min = c(5, 10, 15, 20, 30, 45, 60, 90, 120, 180, 240, 360, 540, 720, 1080, 1440, 2880, 4320),
  source = "KOSTRA-DWD-2010R"
  )



xts1 <- calc_designstorm(kostra_ref, d = d, tn = 20, type = "EulerII")

xts2 <- calc_designstorm(stats_ref, d = d, tn = 20, type = "EulerII")

# calc_designstorm(kostra_ref, d = d, tn = 20, type = "EulerII") |> dput() -----

xts_ref <- structure(
  c(3.2, 4, 5.8, 11.3, 2.4, 2.4, 1.77, 1.77, 1.77, 1.43, 1.43, 1.43),
  dim = c(12L, 1L),
  index = structure(
    c(946681200, 946681500, 946681800, 946682100, 946682400, 946682700, 946683000, 946683300, 946683600, 946683900, 946684200, 946684500),
    tzone = "",
    tclass = c("POSIXct", "POSIXt")
    ),
  class = c("xts", "zoo"),
  STAT_ID = "49011",
  STAT_NAME = "KOSTRA-DWD-2010R",
  X = 366990.016400591,
  Y = 5700144.95258628,
  CRS_EPSG = "25832",
  PARAMETER = "Niederschlagshoehe",
  TS_START = structure(
    list(sec = 0,
         min = 0L,
         hour = 0L,
         mday = 1L,
         mon = 0L,
         year = 51L,
         wday = 1L,
         yday = 0L,
         isdst = 0L,
         zone = "CET",
         gmtoff = NA_integer_),
    class = c("POSIXlt","POSIXt"),
    tzone = c("CET", "CET", "CEST")
    ),
  TS_END = structure(
    list(sec = 0,
         min = 0L,
         hour = 0L,
         mday = 31L,
         mon = 11L,
         year = 110L,
         wday = 5L,
         yday = 364L,
         isdst = 0L,
         zone = "CET",
         gmtoff = NA_integer_),
    class = c("POSIXlt","POSIXt"),
    tzone = c("CET", "CET", "CEST")
    ),
  TS_TYPE = "simulation",
  MEAS_UNIT = "mm",
  MEAS_INTERVALTYPE = TRUE,
  MEAS_RESOLUTION = 5,
  MEAS_BLOCKING = "right",
  MEAS_STATEMENT = "sum",
  REMARKS = "Modellregen Euler Typ II auf Grundlage von KOSTRA-DWD-2010R\nTn = 20 a | D = 60 min | hN = 38.7 mm\n--------------------------------------------------------------------------------\n"
  )
